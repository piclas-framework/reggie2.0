# Settings
# ----------------------------------------------------------------------------------------------------------------------------------------------------
# Load modules on new boltzplatz reggie
before_script:
  - ulimit -s unlimited
  - module list || true
  - python3 -V || true
  - python2 -V || true

# ----------------------------------------------------------------------------------------------------------------------------------------------------
# Stages
# ----------------------------------------------------------------------------------------------------------------------------------------------------
stages:
  - checkin
  - deploy

# ----------------------------------------------------------------------------------------------------------------------------------------------------
# Stage "checkin": Run reggie wiht -h
# ----------------------------------------------------------------------------------------------------------------------------------------------------
checkin:
  stage: deploy
  script:
    - if [ -x "$(command -v python2)" ]; then echo "Testing python 2"; python2 ./reggie.py -h; fi
    - if [ -x "$(command -v python3)" ]; then echo "Testing python r"; python3 ./reggie.py -h; fi
  rules:
    - if: '$DO_CHECKIN'
    - if: '$CI_PIPELINE_SOURCE == "push"'
# ----------------------------------------------------------------------------------------------------------------------------------------------------
# Stage "github": Push the master branch to github
# ----------------------------------------------------------------------------------------------------------------------------------------------------
github:
  stage: deploy
  script:
    - if [ -z "${DO_DEPLOY}" ]; then exit ; fi
    - rm -rf reggie_github || true ;
    - git clone -b master --single-branch git@gitlab.com:reggie2.0/reggie2.0.git reggie_github ;
    - cd reggie_github ;
    - git remote add piclas-framework git@github.com:piclas-framework/reggie2.0.git ;
    - git push --force --follow-tags piclas-framework master ;
    - git remote add reggie-framework git@github.com:reggie-framework/reggie2.0.git ;
    - git push --force --follow-tags reggie-framework master ;
  rules:
    - if: '$DO_DEPLOY'
